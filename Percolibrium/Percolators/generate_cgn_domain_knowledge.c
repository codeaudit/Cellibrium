/*****************************************************************************/
/*                                                                           */
/* File: generate_cgn_domain_knowledge.c                                     */
/*                                                                           */
/* Created: Mon Nov 21 14:10:46 2016                                         */
/*                                                                           */
/*****************************************************************************/

 // Conceptual sketch for convergently updating graph knowledge representation
 // This marries/matches with Narrators/stories-fs.c

 // gcc -o gen_knowledge -g -std=c99 generate_cgn_domain_knowledge.c

 // Usage example: ./gen_knowledge > ExampleTupleData/domain_knowledge_graph

#include <stdlib.h>
#include <stdio.h>
#include <dirent.h>
#include <string.h>
#include <unistd.h>
#include <time.h>
#include <sys/stat.h>
#include <sys/types.h>
#include <utime.h>

typedef int Policy;  // Hack to use CGNgine defs

#define true 1
#define false 0
#define CGN_BUFSIZE 256
#define MAX_ASSOC_ARRAY 128

// Import standard link definitions

#define GRAPH 1
#include "../../RobIoTs/CGNgine/libpromises/graph.h"
#include "../../RobIoTs/CGNgine/libpromises/graph_defs.c"

/******************************************************************************/

void main()
{
 Gr(stdout,"operating system",a_generalizes,"linux","system monitoring");

// These tuples might be generated by a code audit / scanner

Gr(stdout,"CGNgine error messages",a_contains,"Cannot mix CIDR notation with xxx-yyy range notation *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Not a valid address range - or not a fully qualified name *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Cannot handle ipv6 masks which are not 8 bit multiples (fix me)","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Mixture of IPv6 and IPv4 addresses","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Cannot mix CIDR notation with xx-yy range notation","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"FIPS mode is enabled, and md5 is not an approved algorithm","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"process_select body missing its a process_result return value","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"bundle_return_value promise for * in bundle * with too many constraints (ignored)","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Unsupported database type * in databases promise","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Neighbour IP address should be a host not be a network address * in BGP interface promise","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Unsupported user policy * in users promise","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Error writing marker file *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Error removing marker file *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Failed to decrypt string","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Failed to repair database *, recreating...","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Host class counting is only available in CFEngine Enterprise","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Chop was called on a string that seemed to have no terminator","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Bundle aborted on defined class *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Setting abort for * when setting *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Unable to parse class expression *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Syntax error in expression *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"While persisting class *, error reading existing value","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Chop was called on a string that seemed to have no terminator","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Bundle aborted on defined class *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Setting abort for * when setting class *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"The value of variable * contains a reference to itself, *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"An item in list variable * contains a reference to itself","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Variable *' cannot be added because ","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"You cannot use reserved hard class * as post-condition class","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"You cannot cancel a reserved hard class * in post-condition classes","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Unable to open private log *","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"Could not get host entry age","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"getusers is not implemented","errors and faults");
Gr(stdout,"CGNgine error messages",a_contains,"FIPS mode is enabled and md5 is not an approved algorithm","errors and faults");

// Derivatives

Gr(stdout,"Cannot mix CIDR notation with xxx-yyy range notation *", a_related_to,"CIDR","errors and faults");

Gr(stdout,"CIDR",a_related_to,"Classless Internet Domain Routing","*");
Gr(stdout,"CIDR",a_related_to,"Routing","*");

Gr(stdout,"Cannot mix CIDR notation with xxx-yyy range notation *", a_caused_by,"network policy","errors and faults");
Gr(stdout,"Cannot mix CIDR notation with xxx-yyy range notation *", a_caused_by,"FuzzySetMatch","errors and faults");

// Trying to curate the story now....:( This is about information/documentation design
// We can try to make documentation causal instead of encyclopaedic

Gr(stdout,"Cannot mix CIDR notation with xxx-yyy range notation *", a_caused_by,"incorrect use of network pattern matching","errors and faults");

Gr(stdout,"incorrect use of network pattern matching",a_related_to,"network pattern matching", "errors and faults");

Gr(stdout,"pattern matching", a_contains, "network pattern matching","*");
Gr(stdout,"pattern matching", a_contains, "wildcards","*");
Gr(stdout,"pattern matching", a_contains, "regular expressions","*");


Gr(stdout, "iprange" ,a_uses,"FuzzySetMatch","software");
Gr(stdout, "iprange" ,a_depends,"network pattern matching","software");


Gr(stdout, "iprange" ,a_hasrole,"CGNgine class function","software");
Gr(stdout, "iprange" ,a_hasrole,"host classifier","software");
Gr(stdout, "iprange" ,a_hasattr,"host","software");
Gr(stdout, "iprange" ,a_hasattr,"host classifier","software");

Gr(stdout, "class or context label" ,a_alias,"host classifier","system monitoring");

Gr(stdout, "CGNgine class function",a_contains,"iprange","software");
Gr(stdout, "system policy", a_contains, "CGNgine class function","software");
Gr(stdout, "CGNgine functions", a_contains, "CGNgine class function","software");
Gr(stdout, "CGNgine policy language", a_contains, "CGNgine functions","software");
Gr(stdout,"network policy",a_contains,"interfaces configuration","software");

}

/**********************************************************************/

void Gr(FILE *consc,char *from, enum associations assoc, char *to, char *context)
{
 fprintf(consc,"(%s,%d,%s,%s,%s,%s)\n",from,A[assoc].type,A[assoc].fwd,to,A[assoc].bwd,context);
}

/**********************************************************************/

void GrNOT(FILE *consc,char *from, enum associations assoc, char *to, char *context)
{
 fprintf(consc,"(%s,%d,NOT %s,%s,NOT %s,%s)\n",from,A[assoc].type,A[assoc].fwd,to,A[assoc].bwd,context);
}
